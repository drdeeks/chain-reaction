# Bugs 31-40 - Deep Analysis

## 10 Additional Critical Issues Found

### Bug #31: Query Client Has Infinite Stale Time
**Severity**: Medium  
**Location**: `client/src/lib/queryClient.ts`  
**Issue**: `staleTime: Infinity` means data never refetches, users see stale data
**Fix**: Set reasonable staleTime (e.g., 5 minutes)

### Bug #32: No Retry Logic on Mutations
**Severity**: Low  
**Location**: `client/src/lib/queryClient.ts`  
**Issue**: `retry: false` on mutations means transient network errors fail permanently
**Fix**: Add retry with exponential backoff for mutations

### Bug #33: createPuzzle Doesn't Check for Duplicate Chains
**Severity**: Medium  
**Location**: `server/storage.ts`  
**Issue**: Can create identical puzzles multiple times
**Fix**: Check if chain already exists before insert

### Bug #34: submitScore Doesn't Prevent Duplicate Submissions
**Severity**: High  
**Location**: `server/storage.ts`  
**Issue**: Same player can submit multiple scores for same puzzle
**Fix**: Add unique constraint or check before insert

### Bug #35: No Error Boundary in App
**Severity**: High  
**Location**: `client/src/App.tsx`  
**Issue**: Uncaught errors crash entire app
**Fix**: Add React Error Boundary component

### Bug #36: Leaderboard Query Doesn't Handle Empty Results
**Severity**: Low  
**Location**: `client/src/hooks/use-leaderboard.ts`  
**Issue**: No UI feedback when leaderboard is empty
**Fix**: Return empty array explicitly, handle in UI

### Bug #37: Game State Not Persisted on Refresh
**Severity**: Medium  
**Location**: `client/src/pages/Game.tsx`  
**Issue**: Refreshing page loses all progress
**Fix**: Use localStorage to persist game state

### Bug #38: No Validation for Empty Hints Array
**Severity**: Low  
**Location**: `shared/routes.ts`  
**Issue**: Can create puzzle with empty hints array
**Fix**: Add `.min(1)` to hints array validation

### Bug #39: Database Queries Don't Use Transactions
**Severity**: Medium  
**Location**: `server/storage.ts`  
**Issue**: Race conditions possible on concurrent operations
**Fix**: Wrap related operations in transactions

### Bug #40: No Logging for Failed Operations
**Severity**: Low  
**Location**: All server routes  
**Issue**: Errors logged to console but not to file/service
**Fix**: Add proper logging middleware (winston/pino)

---

## Priority Classification

**High Priority (Fix Now)**:
- Bug #34: Duplicate score submissions
- Bug #35: No error boundary

**Medium Priority (Fix Soon)**:
- Bug #31: Infinite stale time
- Bug #33: Duplicate puzzles
- Bug #37: State persistence
- Bug #39: No transactions

**Low Priority (Nice to Have)**:
- Bug #32: Mutation retry
- Bug #36: Empty leaderboard
- Bug #38: Empty hints validation
- Bug #40: Logging infrastructure
