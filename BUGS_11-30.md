# Additional 20 Bugs Found - Chain Reaction

## Deep Analysis - 20 More Critical Issues

### Bug #11: No Rate Limiting on API Endpoints
**Severity**: Critical  
**Location**: `server/index.ts`  
**Issue**: No rate limiting allows DoS attacks
**Fix**: Add express-rate-limit middleware

### Bug #12: Missing CORS Configuration
**Severity**: High  
**Location**: `server/index.ts`  
**Issue**: No CORS headers, will fail in production with different domains
**Fix**: Add cors middleware with proper configuration

### Bug #13: Leaderboard Missing Foreign Key Constraint
**Severity**: High  
**Location**: `shared/schema.ts`  
**Issue**: puzzleId has no foreign key reference to puzzles table
**Fix**: Add `.references(() => puzzles.id)`

### Bug #14: No Input Sanitization for Player Names
**Severity**: High  
**Location**: `shared/routes.ts` - leaderboard.submit
**Issue**: Player names not sanitized, allows XSS
**Fix**: Add string sanitization and HTML escaping

### Bug #15: Missing Pagination on Leaderboard
**Severity**: Medium  
**Location**: `server/storage.ts` - getLeaderboard
**Issue**: Hardcoded limit of 100, no pagination support
**Fix**: Add offset/limit parameters

### Bug #16: No Validation for Negative Completion Time
**Severity**: Medium  
**Location**: `shared/routes.ts` - leaderboard.submit.body
**Issue**: completionTime can be negative or zero
**Fix**: Add `.min(1)` to completionTime validation

### Bug #17: No Validation for Negative Hints Used
**Severity**: Medium  
**Location**: `shared/routes.ts` - leaderboard.submit.body
**Issue**: hintsUsed can be negative
**Fix**: Add `.min(0)` to hintsUsed validation

### Bug #18: Database Connection Pool Not Closed on Shutdown
**Severity**: Medium  
**Location**: `server/db.ts` and `server/index.ts`  
**Issue**: No graceful shutdown handler
**Fix**: Add SIGTERM/SIGINT handlers to close pool

### Bug #19: Error Handler Throws After Sending Response
**Severity**: High  
**Location**: `server/index.ts` - error middleware
**Issue**: `throw err` after `res.status().json()` causes crash
**Fix**: Remove throw or use next(err)

### Bug #20: Missing Indexes on Database Tables
**Severity**: Medium  
**Location**: `shared/schema.ts`  
**Issue**: No indexes on puzzleId, score, createdAt
**Fix**: Add index definitions

### Bug #21: No Timeout on Fetch Requests
**Severity**: Medium  
**Location**: All hooks using fetch
**Issue**: Fetch can hang indefinitely
**Fix**: Add AbortController with timeout

### Bug #22: Puzzle Creation Doesn't Trim Whitespace
**Severity**: Low  
**Location**: `shared/routes.ts` - puzzles.create.body
**Issue**: Words can have leading/trailing spaces
**Fix**: Add `.transform(s => s.trim())` to chain strings

### Bug #23: Share URL Uses req.get('host') Without Validation
**Severity**: High  
**Location**: `server/routes.ts` - share endpoint
**Issue**: Host header can be spoofed for phishing
**Fix**: Use environment variable for base URL

### Bug #24: No Maximum Length on Puzzle Chains
**Severity**: Low  
**Location**: `shared/routes.ts` - puzzles.create.body
**Issue**: Max is 10 but no enforcement on display
**Fix**: Already has `.max(10)` - verify UI respects it

### Bug #25: Missing createdAt Parsing in Client
**Severity**: Low  
**Location**: `shared/routes.ts` - api.puzzles.list.responses
**Issue**: createdAt is Date but comes as string from API
**Fix**: Add `.transform()` to parse ISO string to Date

### Bug #26: No Debouncing on Input Field
**Severity**: Low  
**Location**: `client/src/components/GameControls.tsx`  
**Issue**: onChange fires on every keystroke
**Fix**: Add debounce to setInputValue

### Bug #27: Confetti Fires Multiple Times on Re-render
**Severity**: Low  
**Location**: `client/src/pages/Game.tsx`  
**Issue**: useEffect dependency array causes multiple confetti
**Fix**: Add ref to track if confetti already fired

### Bug #28: No Loading State for Share Button
**Severity**: Low  
**Location**: `client/src/pages/Game.tsx`  
**Issue**: Share button doesn't show loading state
**Fix**: Use generateShare.isPending

### Bug #29: buildUrl Doesn't Handle Missing Params
**Severity**: Medium  
**Location**: `shared/routes.ts` - buildUrl function
**Issue**: Returns URL with `:puzzleId` if param missing
**Fix**: Throw error if required param missing

### Bug #30: No Validation That Chain Words Are in Word Bank
**Severity**: High  
**Location**: `server/routes.ts` - puzzle creation
**Issue**: Can create puzzles with words not in PAINT_COLORS
**Fix**: Validate all words exist in word bank

---

## Priority Order

**Critical (Fix Immediately)**:
- Bug #11: Rate limiting
- Bug #12: CORS
- Bug #19: Error handler crash
- Bug #23: Host header spoofing
- Bug #30: Word bank validation

**High (Fix Soon)**:
- Bug #13: Foreign key constraint
- Bug #14: XSS in player names

**Medium (Fix Next Sprint)**:
- Bugs #15-18, #21, #29

**Low (Nice to Have)**:
- Bugs #22, #24-28
